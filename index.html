<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Snake's blog</title>
	<link rel="shortcut icon" href="https://cdn.luogu.com.cn/upload/usericon/1393230.png">
	<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/@fortawesome/fontawesome-free@6.5.0/css/all.min.css">
	<link rel="stylesheet"
		href="https://cdn.jsdmirror.com/gh/highlightjs/cdn-release@11.11.1/build/styles/github.min.css">
	<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/katex@0.16.9/dist/katex.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Caveat&display=swap">
	<link href="https://fonts.googleapis.com/css2?family=Long+Cang&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css">
	<link rel="stylesheet" type="text/css" href="./css/markdown.css">
	<link rel="stylesheet" type="text/css" href="./css/codecopy-btn.css">
	<style>
		body {
			font-family: "Segoe UI", sans-serif;
			margin: 0;
			padding: 0;
			background-color: #f8fafc;
			color: #333;
		}

		.navbar {
			margin-top: 0;
			width: 100%;
			height: 60px;
			background: rgba(60, 72, 88, 0.81);
			z-index: 101;
			position: fixed;
			backdrop-filter: blur(3px);
		}

		.bg {
			margin-top: 0;
			color: #000;
			background: #f9f9f9;
			text-align: center;
			height: 100vh;
			width: 100%;
			align-items: center;
			/* position: absolute; */
			background-image: url('https://cdn.luogu.com.cn/upload/image_hosting/47bgud87.png');
			/* background-size: contain; */
			background-position: center;
			background-repeat: no-repeat;
		}

		.bg .homesubtitle {
			top: 35%;
			font-size: 4.5rem;
			font-family: 'Caveat';
			position: relative;
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
			animation: fadeIn 1.5s ease-in-out;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(20px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.bg .subtitle {
			top: 37%;
			font-size: 2rem;
			/* font-family: LXGW WenKai Screen; */
			font-family: 'Long Cang';
			position: relative;
		}

		.bg .shicibox {
			top: 46%;
			max-width: 500px;
			margin: auto;
			position: absolute;
			font-family: LXGW WenKai Screen;
			text-align: right;
			bottom: 0;
			left: 0;
			right: 0;
		}

		.bg .shici {
			font-size: 1.7rem;
		}

		.bg .shicifrom {
			font-size: 1.2rem;
		}

		#blog-main {
			max-width: 800px;
			margin: 2rem auto;
			padding: 1.5rem;
			background: #f8fafc;
			border-radius: 8px;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
		}

		.scroll-down-bar {
			position: absolute;
			width: 100%;
			height: 5rem;
			text-align: center;
			cursor: pointer;
			bottom: 0;
		}

		.scroll-down-bar .icon {
			zoom: 2.2;
			animation: float 2s ease-in-out infinite;
		}

		@keyframes float {

			0%,
			100% {
				transform: translateY(0);
			}

			50% {
				transform: translateY(-20px);
			}
		}

		.post-list-container {
			padding: 0 2rem;
		}

		.search-box {
			display: block;
			width: calc(100% - 6.2rem);
			margin: 1rem auto;
			padding: 0.6rem 1rem;
			font-size: 1rem;
			border: 1px solid #ccc;
			border-radius: 6px;
		}

		.post-card {
			border-bottom: 1px solid #eee;
			padding: 1.5rem 1rem;
			cursor: pointer;
			transition: background-color 0.3s ease;
			border: 1px #e2e8f0 solid;
			border-radius: 10px;
			margin: 10px 0;
		}

		.post-card:hover {
			background-color: #f7f7f7;
		}

		.post-title {
			font-size: 1.4rem;
			color: #007acc;
			margin-bottom: 0.5rem;
		}

		.post-desc {
			font-size: 1rem;
			color: #666;
		}

		@font-face {
			font-family: 'Caveat';
			src: url('./font/caveat-regular.ttf') format('truetype');
			font-weight: 400;
			font-style: normal;
			font-display: swap;
		}

		@font-face {
			font-family: 'Time';
			src: url('./font/UnidreamLED.ttf') format('truetype');
			font-weight: 400;
			font-style: normal;
			font-display: swap;
		}

		.post-card {
			background: white;
			border-radius: 8px;
			padding: 1.5rem;
			margin-bottom: 1rem;
			transition: all 0.3s ease;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
		}

		.post-card:hover {
			transform: translateY(-5px);
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
		}

		.post-title {
			color: #2c3e50;
			font-weight: 600;
			margin-bottom: 0.75rem;
		}

		.post-desc {
			color: #7f8c8d;
			line-height: 1.6;
		}
	</style>
	<!-- Matomo -->
	<script>
		var _paq = window._paq = window._paq || [];
		/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
		_paq.push(["setCookieDomain", "*.comforting-toffee-86a58e.netlify.app"]);
		_paq.push(['trackPageView']);
		_paq.push(['enableLinkTracking']);
		(function () {
			var u = "https://comfortingtoffee86a58enetlifyapp.matomo.cloud/";
			_paq.push(['setTrackerUrl', u + 'matomo.php']);
			_paq.push(['setSiteId', '1']);
			var d = document, g = d.createElement('script'), s = d.getElementsByTagName('script')[0];
			g.async = true; g.src = 'https://cdn.matomo.cloud/comfortingtoffee86a58enetlifyapp.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g, s);
		})();
	</script>
	<!-- End Matomo Code -->
</head>

<body>
	<div class="navbar" id="navbar">
		<div style="font-family: 'Caveat'; font-size: 2rem; color: #fff; margin-top: 5px; margin-left: 1rem;">
			<a href="../index.html">Snake's Blog</a>
		</div>
	</div>
	<div class="bg" id="banner">
		<div class="subtitle" id="subtitle" style="display: none;"></div>
		<div class="homesubtitle" id="homesubtitle" style="display: none;">Snake's Blog</div>
		<div class="shicibox">
			<div class="shici" id="shici"></div>
			<div class="shicifrom" id="shicifrom"></div>
		</div>
	</div>
	<div class="scroll-down-bar"><i class="icon fa-solid fa-chevron-down" id="down-button"
			style="display: none; color: #fff;"></i>
	</div>
	<div id="blog-main">
		<p>加载中...</p>
	</div>
	<div id="post-list" style="display: none;">
		<input type="text" class="search-box" placeholder="输入关键词筛选文章..." />
		<div class="post-list-container"></div>
	</div>
	<script src="https://cdn.jsdmirror.com/npm/marked/marked.min.js"></script>
	<script src="https://cdn.jsdmirror.com/npm/anchor-js/anchor.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/katex@0.16.9/dist/katex.min.css">
	<script src="https://cdn.jsdmirror.com/npm/katex@0.16.9/dist/katex.min.js"></script>
	<script src="https://cdn.jsdmirror.com/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
	<script src="https://cdn.jsdmirror.com/gh/highlightjs/cdn-release@11.11.1/build/highlight.min.js"></script>
	<script src="https://cdn.jsdmirror.com/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>
	<script>
		function fetchshici() {
			const shici = document.querySelector('#shici');
			const shicifrom = document.querySelector('#shicifrom');
			shici.innerText = '';
			shicifrom.innerText = '';
			fetch('https://v1.jinrishici.com/all', {
				cache: "no-store"
			}
			).then(response => response.json())
				.then(data => {
					shici.innerText = '『 ' + data.content + '』';
					shicifrom.innerText = '- ' + data.author + ' 《' + data.origin + '》 ';
				})
				.catch(console.error);
		}
		fetchshici();
	</script>
	<script type="module">
		const posts = [
			{
				title: "Hello!",
				desc: "Hello!",
				file: "hello.md"
			},
			{
				title: "404",
				desc: "404",
				file: "404.md"
			},
			{
				title: "洛谷题解：P3371 【模板】单源最短路径（弱化版）",
				desc: "洛谷题解：P3371 【模板】单源最短路径（弱化版）",
				file: "tj-luogu-p3371.md"
			}
		];

		const postmap = [
			{
				x: '洛谷题解：P3371 【模板】单源最短路径（弱化版）',
				y: 'tj-luogu-p3371.md'
			}
		];

		const url = new URL(location.href);
		const params = new URLSearchParams(url.search);
		let param1 = params.get('blog');

		if (!param1) {
			location.href = '?blog=index.md';
			exit();
		}

		setInterval(() => {
			if (window.scrollY === 0) {
				document.getElementById('navbar').style.backgroundColor = 'rgba(0, 0, 0, 0)';
				document.getElementById('navbar').style.boxShadow = '0 2px 5px 0 rgba(0, 0, 0, 0.16), 0 2px 10px 0 rgba(0, 0, 0, 0.12);';
				document.getElementById('navbar').style.transition = 'transition: background 0.5s ease-in-out, padding 0.5s ease-in-out;';
			}
			else {
				document.getElementById('navbar').style.backgroundColor = 'rgba(60, 72, 88, 0.81)';
				document.getElementById('navbar').style.boxShadow = 'none';
				document.getElementById('navbar').style.transition = 'none';
			}
		}, 100);

		async function fetchAndRenderMarkdown() {
			try {
				const response = await fetch('/md/' + param1);
				if (!response.ok) throw new Error('Network response was not ok: ' + response.status);

				const md = await response.text();
				const html = marked.parse(md);
				document.getElementById('blog-main').innerHTML = html;

				anchors.add();
				if (param1 === 'index.md') document.title = "首页 | Snake's blog";
				else document.title = param1.substring(0, param1.length - 3) + " | Snake's blog";

				renderMath();
				hljs.highlightAll();
				addCopyButtons();
			} catch (error) {
				console.error('加载失败:', error);
				document.getElementById('blog-main').innerHTML = `
                <h1 style="margin-top: 0px;">错误</h1>
                <div style="font-family: 'Caveat'; font-size: 2rem; margin-top: -7px;">${error}</div><br/>发生了错误，请检查网络连接或联系管理员。`;
			}
		}

		function renderMath() {
			if (typeof renderMathInElement === 'function') {
				renderMathInElement(document.body, {
					delimiters: [
						{ left: '$$', right: '$$', display: true },
						{ left: '$', right: '$', display: false },
						{ left: '\\(', right: '\\)', display: false },
						{ left: '\\[', right: '\\]', display: true }
					],
					ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre']
				});
			}
		}

		function addCopyButtons() {
			const preElements = document.querySelectorAll('pre code');
			preElements.forEach(codeElement => {
				const button = document.createElement('button');
				button.innerHTML = '<i class="fa-solid fa-copy"></i>';
				button.classList.add('codecopy-btn');

				const div = document.createElement('div');
				div.style = "width:100%;position:relative;";
				div.appendChild(button);
				codeElement.before(div);

				new ClipboardJS(button, {
					text: () => codeElement.innerText.replace(/\n\n/g, "\n")
				}).on('success', e => {
					e.trigger.innerHTML = '<i class="fa-solid fa-check"></i>';
					setTimeout(() => e.trigger.innerHTML = '<i class="fa-solid fa-copy"></i>', 1000);
				}).on('error', e => {
					e.trigger.innerHTML = '<i class="fa-solid fa-xmark"></i>';
					setTimeout(() => e.trigger.innerHTML = '<i class="fa-solid fa-copy"></i>', 1000);
				});
			});
		}

		console.log(param1);
		if (param1 === 'index.md') {
			document.getElementById('homesubtitle').style.display = 'block';
			document.getElementById('down-button').style.display = 'block';
			document.getElementById('blog-main').style.display = 'none';
			document.getElementById('post-list').style.display = 'block';

			setInterval(function () {
				if (window.scrollY === 0) {
					document.getElementById('down-button').style.display = 'block';
				} else {
					document.getElementById('down-button').style.display = 'none';
				}
			}, 500);
			document.getElementById('down-button').addEventListener('click', function () {
				let tmp = 0;
				setInterval(() => {
					if (tmp < 1000) {
						tmp += 70;
						window.scrollTo(0, tmp);
					}
				}, 10);
			});

			const postListContainer = document.querySelector('.post-list-container');

			function renderPosts(filteredPosts) {
				postListContainer.innerHTML = '';
				filteredPosts.forEach(post => {
					const card = document.createElement('div');
					card.className = 'post-card';
					card.innerHTML = `
        <a href="?blog=${post.file}" style="text-decoration: none; color: inherit;">
          <div class="post-title">${post.title}</div>
          <div class="post-desc">${post.desc}</div>
        </a>
      `;
					postListContainer.appendChild(card);
				});
			}

			// 初始渲染全部文章
			renderPosts(posts);

			// 添加搜索事件监听
			document.querySelector('.search-box').addEventListener('input', async (e) => {
				const keyword = e.target.value.trim().toLowerCase();
				if (!keyword) {
					renderPosts(posts);
					return;
				}

				const results = [];

				for (const post of posts) {
					try {
						const response = await fetch(`/md/${post.file}`);
						const mdText = await response.text();
						if (mdText.toLowerCase().includes(keyword)) {
							results.push(post);
						}
					} catch (err) {
						console.error(`加载 ${post.file} 出错`, err);
					}
				}

				renderPosts(results);
			});
		}
		else {
			document.getElementById('subtitle').style.display = 'block';
			document.getElementById('banner').style.height = '50vh';
			document.getElementById('shici').style.display = 'none';
			document.getElementById('shicifrom').style.display = 'none';
			let tpostmap = postmap;
			tpostmap.forEach(post => {
				if (post.y === param1) {
					document.getElementById('subtitle').innerHTML = `<span style="color: #1e1e1e;text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);">${post.x}</span>`;
				}
			});
			fetchAndRenderMarkdown();
		}
	</script>

</body>

</html>
