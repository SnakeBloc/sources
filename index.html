<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Snake集团资源中心</title>
	<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
	<script src="https://cdn.jsdmirror.com/npm/jszip@3.10.1/dist/jszip.min.js"></script>
	<script src="https://cdn.jsdmirror.com/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
	<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css">
	<link rel="stylesheet"
		href="https://cdn.jsdmirror.com/gh/highlightjs/cdn-release@11.9.0/build/styles/github.min.css">
	<script src="https://cdn.jsdmirror.com/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
	<script src="https://cdn.jsdmirror.com/gh/highlightjs/cdn-release@11.9.0/build/languages/markdown.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/katex@0.16.8/dist/katex.min.css">
	<script src="https://cdn.jsdmirror.com/npm/katex@0.16.8/dist/katex.min.js"></script>
	<script defer src="https://cdn.jsdmirror.com/npm/katex@0.16.8/dist/contrib/auto-render.min.js"
		onload="renderMathInElement(document.body);"></script>
	<script src="https://cdn.jsdmirror.com/npm/marked@15.0.7/marked.min.js"></script>
	<script src="https://cdn.jsdmirror.com/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>
	<style>
		#preview-modal pre code.hljs {
			font-family: 'Consolas';
			display: block;
			padding: 12px !important;
			margin: 2rem 0;
			background: #f8fafc;
			border-radius: 10px;
			border: 1px solid #e2e8f0;
			overflow-x: auto;
			overflow-y: auto;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
		}

		#preview-modal blockquote {
			background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%) !important;
			border-left: 4px solid #0ea5e9 !important;
			margin: 1.5rem 0 !important;
			padding: 0.4rem 1.8rem !important;
			padding-top: 1.5rem !important;
			border-radius: 0 10px 10px 0 !important;
			font-size: 1.05rem !important;
			box-sizing: inherit;
			display: block;
			margin-block-start: 1em;
			margin-block-end: 1em;
			margin-inline-start: 40px;
			margin-inline-end: 40px;
			unicode-bidi: isolate;
		}

		#preview-modal blockquote p {
			margin-top: 0px;
		}

		img {
			max-width: 100% !important;
			height: auto !important;
			border-radius: 8px !important;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
			margin: 1.5rem 0 !important;
			transition: transform 0.3s ease, box-shadow 0.3s ease !important;
			cursor: pointer !important;
			display: block !important;
			border-style: none;
			overflow: clip;
		}

		img:hover {
			transform: scale(1.02) !important;
			box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
		}

		#preview-modal ul {
			display: block;
			list-style-type: disc;
			margin-block-start: 1em;
			margin-block-end: 1em;
			padding-inline-start: 40px;
			unicode-bidi: isolate;
		}

		#preview-modal ol {
			display: block;
			list-style-type: decimal;
			margin-block-start: 1em;
			margin-block-end: 1em;
			padding-inline-start: 40px;
			unicode-bidi: isolate;
		}

		svg {
			pointer-events: none;
		}

		#preview-modal p {
			margin-bottom: 1.3rem;
			font-size: 1.1rem;
		}

		#preview-modal a {
			background-position: 0 100%;
			background-repeat: repeat-x;
			background-size: 5px 5px;
			text-decoration: none;
			transition: all .35s ease;
			color: #000;
			background-image: linear-gradient(to bottom, rgba(14, 165, 233, .55) 0%, rgba(14, 165, 233, .55) 100%);
		}

		#preview-modal a:hover {
			color: white;
			background-size: 5px 50px;
		}

		#preview-modal table {
			border-collapse: collapse !important;
			border-spacing: 0 !important;
			overflow-x: auto;
			min-width: 600px !important;
			font-size: 1rem !important;
			width: 100%;
			margin: 2rem 0;
			border-radius: 10px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			border: 1px solid #e2e8f0;
			background: white;
		}

		#preview-modal thead {
			display: table-header-group;
			vertical-align: middle;
			unicode-bidi: isolate;
			border-color: inherit;
			border-radius: 10px;
		}

		#preview-modal tbody {
			border-radius: 10px;
		}

		#preview-modal tr {
			display: table-row;
			vertical-align: inherit;
			unicode-bidi: isolate;
			border-color: inherit;
		}

		#preview-modal th {
			background: #f8fafc !important;
			font-weight: 600 !important;
			color: #374151 !important;
			border-bottom: 2px solid #e2e8f0 !important;
		}

		#preview-modal th,
		#preview-modal td {
			padding: 12px 16px !important;
			font-size: 1rem !important;
			border-bottom: 1px solid #e2e8f0;
			border-right: 1px solid rgba(34, 36, 38, .1);
			white-space: nowrap;
		}

		#preview-modal table tbody tr:hover {
			background-color: #f8fafc;
		}

		#preview-modal .codecopy-btn {
			opacity: 0.7 !important;
			min-height: 1em;
			outline: 0;
			vertical-align: baseline;
			position: absolute;
			top: 10px !important;
			right: 10px !important;
			background: #f8fafc;
			padding: 6px 10px !important;
			color: rgba(0, 0, 0, 0.6);
			border: 1px solid rgba(0, 0, 0, 0.1);
			box-shadow: transparent 0px 0px 0px 1px inset, rgba(34, 36, 38, 0.15) 0px 0px 0px 0px inset;
			cursor: pointer;
			z-index: 10;
			text-transform: none;
			text-shadow: none;
			font-weight: 700;
			line-height: 1em;
			font-style: normal;
			text-align: center;
			text-decoration: none;
			border-radius: .28571429rem;
			font-size: 0.8rem !important;
			display: inline-block !important;
			padding-block: 1px;
			padding-inline: 6px;
			margin: 0 .25em 0 0;
		}

		#preview-modal .codecopy-btn icon {
			font-weight: 0.8rem !important;
		}

		#preview-modal .codecopy-btn:active {
			background-color: rgb(186, 187, 188);
			color: rgba(0, 0, 0, 0.9);
		}

		#preview-modal .codecopy-btn:hover {
			background: #fff;
			transform: translateY(-1px);
			background-color: rgb(202, 203, 205);
			box-shadow: transparent 0px 0px 0px 1px inset, rgba(34, 36, 38, 0.15) 0px 0px 0px 0px inset;
			color: rgba(0, 0, 0, 0.8);
		}

		#preview-modal .codecopy-btn:focus {
			background-color: rgb(202, 203, 205);
			color: rgba(0, 0, 0, 0.8);
		}
	</style>
	<style>
		:root {
			--primary-color: #4a6fa5;
			--secondary-color: #166088;
			--accent-color: #4fc3f7;
			--dark-color: #2c3e50;
			--light-color: #f8f9fa;
			--success-color: #28a745;
			--warning-color: #ffc107;
			--danger-color: #dc3545;
			--border-radius: 0px;
			--box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			--transition: all 0.3s ease;
		}

		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			line-height: 1.6;
			background-color: #f8fafc;
			color: #333;
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
			padding: 20px;
		}

		header {
			background: linear-gradient(135deg, #f4faff, #e5f2ff);
			color: #1e1e1e;
			padding: 20px;
			border-radius: var(--border-radius);
			margin-bottom: 25px;
			box-shadow: var(--box-shadow);
			display: flex;
			align-items: center;
			justify-content: space-between;
		}

		.logo {
			display: flex;
			align-items: center;
			gap: 15px;
		}

		.logo i {
			font-size: 2rem;
			color: var(--accent-color);
		}

		.logo-text h1 {
			font-size: 1.8rem;
			font-weight: 600;
			margin-bottom: 5px;
		}

		.logo-text p {
			font-size: 0.9rem;
			opacity: 0.9;
		}

		.logo-text a {
			color: #333;
		}

		.breadcrumb {
			display: flex;
			align-items: center;
			flex-wrap: wrap;
			gap: 8px;
			padding: 15px;
			background: #f1f8ff;
			border-radius: var(--border-radius);
			margin-bottom: 0px;
			box-shadow: var(--box-shadow);
			border-bottom: #e2e8f0 1px solid;
		}

		.breadcrumb a {
			color: var(--primary-color);
			text-decoration: none;
			font-weight: 500;
			transition: var(--transition);
			display: flex;
			align-items: center;
			gap: 5px;
		}

		.breadcrumb a:hover {
			color: var(--secondary-color);
			text-decoration: underline;
		}

		.breadcrumb .separator {
			color: #aaa;
			font-size: 0.8rem;
		}

		.file-browser {
			background-color: white;
			border-radius: var(--border-radius);
			box-shadow: var(--box-shadow);
			overflow: hidden;
		}

		.file-browser table {
			width: 100%;
			border-collapse: collapse;
		}

		.file-browser thead {
			background-color: #f4faff;
			color: #1e1e1e;
		}

		.file-browser th {
			padding: 15px;
			text-align: left;
			font-weight: 500;
		}

		.file-browser th:first-child {
			border-top-left-radius: var(--border-radius);
		}

		.file-browser th:last-child {
			border-top-right-radius: var(--border-radius);
		}

		.file-browser td {
			padding: 12px 15px;
			border-bottom: 1px solid #eee;
		}

		.file-browser tr:last-child td {
			border-bottom: none;
		}

		.file-browser tr:hover {
			background-color: #f4faff;
		}

		.file-item {
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.file-icon {
			font-size: 1.2rem;
			width: 24px;
			text-align: center;
		}

		.folder .file-icon {
			color: var(--warning-color);
		}

		.file .file-icon {
			color: var(--primary-color);
		}

		.file-name {
			font-weight: 500;
			color: var(--dark-color);
		}

		.file-actions {
			display: flex;
			gap: 10px;
		}

		.btn {
			padding: 6px 12px;
			border-radius: 4px;
			border: none;
			cursor: pointer;
			font-size: 0.85rem;
			font-weight: 500;
			transition: var(--transition);
			display: inline-flex;
			align-items: center;
			gap: 5px;
		}

		.btn-sm {
			padding: 4px 8px;
			font-size: 0.8rem;
		}

		.btn-primary {
			background-color: #ecf2f7;
			color: #1e1e1e;
		}

		.btn-primary:hover {
			background-color: #e5f2ff;
		}

		.empty-folder {
			text-align: center;
			padding: 40px;
			color: #666;
		}

		.empty-folder i {
			font-size: 3rem;
			margin-bottom: 15px;
			color: #ddd;
		}

		.empty-folder p {
			font-size: 1.1rem;
		}

		/* 响应式设计 */
		@media (max-width: 768px) {
			.file-browser table {
				display: block;
				overflow-x: auto;
			}

			.file-actions {
				flex-direction: column;
				gap: 5px;
			}

			.btn {
				width: 100%;
				justify-content: center;
			}
		}

		/* 动画效果 */
		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(10px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.file-browser tbody tr {
			animation: fadeIn 0.3s ease forwards;
		}

		.file-browser tbody tr:nth-child(1) {
			animation-delay: 0.05s;
		}

		.file-browser tbody tr:nth-child(2) {
			animation-delay: 0.1s;
		}

		.file-browser tbody tr:nth-child(3) {
			animation-delay: 0.15s;
		}

		.file-browser tbody tr:nth-child(4) {
			animation-delay: 0.2s;
		}

		.file-browser tbody tr:nth-child(5) {
			animation-delay: 0.25s;
		}

		.file-browser tbody tr:nth-child(n+6) {
			animation-delay: 0.3s;
		}

		.folder-link {
			color: #1e1e1e;
		}

		@font-face {
			font-family: 'Caveat';
			src: url('./font/caveat-regular.ttf') format('truetype');
			font-weight: 400;
			font-style: normal;
			font-display: swap;
		}
	</style>

	<style>
		.loader-overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: #f8fafc;
			display: flex;
			justify-content: center;
			align-items: center;
			z-index: 9999;
			transition: opacity 0.5s ease;
		}

		.loader {
			width: 100px;
			height: 100px;
			display: inline-block;
			position: relative;
		}

		.loader .bounce1,
		.loader .bounce2 {
			width: 100%;
			height: 100%;
			border-radius: 50%;
			background-color: #61E8EA;
			opacity: 0.6;
			position: absolute;
			top: 0;
			left: 0;
			-webkit-animation: sk-bounce 2.0s infinite ease-in-out;
			animation: sk-bounce 2.0s infinite ease-in-out;
		}

		.loader .bounce2 {
			-webkit-animation-delay: -1.0s;
			animation-delay: -1.0s;
		}

		@-webkit-keyframes sk-bounce {

			0%,
			100% {
				-webkit-transform: scale(0.0)
			}

			50% {
				-webkit-transform: scale(1.0)
			}
		}

		@keyframes sk-bounce {

			0%,
			100% {
				transform: scale(0.0);
				-webkit-transform: scale(0.0);
			}

			50% {
				transform: scale(1.0);
				-webkit-transform: scale(1.0);
			}
		}
	</style>

	<style>
		header,
		.breadcrumb,
		.search-bar,
		.file-browser {
			font-family: LXGW WenKai Screen;
		}
	</style>
</head>

<body>
	<div class="loader-overlay" id="loader">
		<div class="loader" style="left: 50%; top: 46%; transform: translate(-50% , -50%); position: absolute;">
			<div class="bounce1"></div>
			<div class="bounce2"></div>
		</div>
		<div
			style="left: 50%; top: 55%; transform: translate(-50% , -50%); position: absolute; font-size: 1.2rem; font-family: LXGW WenKai Screen;">
			Loading...</div>
	</div>
	<div class="container">
		<header>
			<div class="logo">
				<img src="https://w.saobby.com/w/sbeu7da5">
				<div class="logo-text">
					<h1 style="font-family: 'Caveat' !important; font-size: 3rem !important;">Snake Sources</h1>
					<p>知识共享 · 协作创新<br>欢迎向 <a href="https://www.luogu.com.cn/chat?uid=1393230">zhangyimin12345</a>
						提供文件！文件资源除特殊标注，均可供 <a href="https://hydro.ac/d/Snake/">Snake集团(Hydro OJ)</a>
						外部成员使用。<br>如有相关建议（功能添加建议、样式优化等），欢迎向 <a
							href="https://www.luogu.com.cn/chat?uid=1393230">zhangyimin12345</a>
						私信！</p>
				</div>
			</div>
			<div class="header-actions">
				<button class="btn btn-primary" id="refresh-btn">
					<i class="fas fa-sync-alt"></i> 刷新
				</button>
			</div>
		</header>

		<div class="breadcrumb" id="breadcrumb">
			<a href="#" data-path="">
				<i class="fas fa-home"></i> 首页
			</a>
		</div>

		<div class="file-browser">
			<table>
				<thead>
					<tr>
						<th><input type="checkbox" id="select-all"></th>
						<th>名称</th>
						<th>类型</th>
						<th>大小</th>
						<th>修改日期</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody id="file-list">
				</tbody>
			</table>
		</div>

		<div class="breadcrumb" style="border-top: #e2e8f0 1px solid;">
			<span>下载：</span>
			<button class="btn btn-primary" id="download-selected-files">
				<i class="fas fa-download"></i> 依次下载选中文件
			</button>
			<button class="btn btn-primary" id="download-selected-zip">
				<i class="fas fa-file-archive"></i> 打包下载选中文件
			</button>
		</div>

		<div id="preview-modal"
			style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; overflow:auto;">
			<div
				style="width:90%; height:90%; overflow-y: auto; overflow-y: auto; margin:40px auto; background:#fff; border-radius:8px; padding:20px; color:#333;">
				<button onclick="closePreview()"
					style="float:right; background:var(--danger-color); color:white; border:none; padding:5px 10px; border-radius:8px;"><i
						class="fa-solid fa-xmark"></i></button>
				<div id="preview-content" style="min-height:400px;"></div>
			</div>
		</div>
	</div>

	<script>
		function showLoader() {
			const loader = document.getElementById('loader');
			loader.style.display = 'flex';
			loader.style.opacity = '1';
		}

		function hideLoader() {
			const loader = document.getElementById('loader');
			loader.style.opacity = '0';
			setTimeout(() => {
				loader.style.display = 'none';
			}, 300);
		}

		window.addEventListener('load', () => {
			hideLoader();
		});

		document.addEventListener('DOMContentLoaded', function () {
			let currentPath = '';

			loadFiles(currentPath);

			document.getElementById('breadcrumb').addEventListener('click', function (e) {
				if (e.target.tagName === 'A' || e.target.parentElement.tagName === 'A') {
					e.preventDefault();
					const link = e.target.tagName === 'A' ? e.target : e.target.parentElement;
					const path = link.getAttribute('data-path') || '';
					currentPath = path;
					loadFiles(currentPath);
					updateBreadcrumb(currentPath);
				}
			});

			document.getElementById('file-list').addEventListener('click', function (e) {
				const folderLink = e.target.closest('.folder-link');
				if (folderLink) {
					e.preventDefault();
					const folderPath = folderLink.getAttribute('data-path');
					currentPath = folderPath;
					loadFiles(currentPath);
					updateBreadcrumb(currentPath);
				}
			});

			document.getElementById('refresh-btn').addEventListener('click', function () {
				document.getElementById('select-all').checked = false;
				loadFiles(currentPath);
			});

			document.getElementById('select-all').addEventListener('change', function () {
				const checkboxes = document.querySelectorAll('.file-checkbox');
				checkboxes.forEach(cb => cb.checked = this.checked);
			});

			document.getElementById('download-selected-files').addEventListener('click', function () {
				const selected = document.querySelectorAll('.file-checkbox:checked');
				if (selected.length === 0) {
					alert("请至少选择一个文件");
					return;
				}

				selected.forEach(cb => {
					const path = cb.getAttribute('data-path');
					downloadFile(path);
				});
			});

			document.getElementById('download-selected-zip').addEventListener('click', async function () {
				const selected = document.querySelectorAll('.file-checkbox:checked');
				if (selected.length === 0) {
					alert("请至少选择一个文件");
					return;
				}

				const zip = new JSZip();
				const folder = zip.folder("selected_files");

				const promises = [];
				selected.forEach(cb => {
					const path = cb.getAttribute('data-path');
					const url = `sources/${encodeURIComponent(path)}`;
					const filename = path.split('/').pop();

					promises.push(
						fetch(url)
							.then(res => {
								if (!res.ok) throw new Error(`无法加载文件: ${url}`);
								return res.arrayBuffer();
							})
							.then(data => {
								folder.file(filename, data);
							})
					);
				});

				try {
					await Promise.all(promises);
					const content = await zip.generateAsync({ type: "blob" });
					saveAs(content, "selected_files.zip");
				} catch (err) {
					console.error(err);
					alert("打包失败：" + err.message);
				}
			});
		});

		function previewFile(path, type) {
			const ext = path.split('.').pop().toLowerCase();
			const url = `sources/${encodeURIComponent(path)}`;
			const title = decodeURIComponent(path.split('/').pop());

			const content = document.getElementById('preview-content');
			content.innerHTML = "";

			if (ext === 'pdf') {
				window.open(url, '_blank');
				return;
			}
			else if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) {
				const img = new Image();
				img.src = url;
				img.style.maxWidth = "100%";
				img.style.margin = "auto";
				content.appendChild(img);

			}
			else if (ext === 'txt') {
				fetch(url)
					.then(res => res.text())
					.then(text => {
						const pre = document.createElement('pre');
						pre.textContent = text;
						content.appendChild(pre);
					});

			}
			else if (ext === 'md') {
				fetch(url)
					.then(res => res.text())
					.then(mdText => {
						const html = marked.parse(mdText);
						content.innerHTML = html;

						hljs.highlightAll();

						renderMathInElement(content, {
							delimiters: [
								{ left: "$$", right: "$$", display: true },
								{ left: "$", right: "$", display: false }
							],
							throwOnError: false
						});

						function addCopyButtons() {
							const preElements = document.querySelectorAll('pre code');
							preElements.forEach(codeElement => {
								const button = document.createElement('button');
								button.innerHTML = '<i class="fa-solid fa-copy"></i>';
								button.classList.add('codecopy-btn');

								const div = document.createElement('div');
								div.style = "width:100%;position:relative;";
								div.appendChild(button);
								codeElement.before(div);

								new ClipboardJS(button, {
									text: () => codeElement.innerText.replace(/\n\n/g, "\n")
								}).on('success', e => {
									e.trigger.innerHTML = '<i class="fa-solid fa-check"></i>';
									setTimeout(() => e.trigger.innerHTML = '<i class="fa-solid fa-copy"></i>', 1000);
								}).on('error', e => {
									e.trigger.innerHTML = '<i class="fa-solid fa-xmark"></i>';
									setTimeout(() => e.trigger.innerHTML = '<i class="fa-solid fa-copy"></i>', 1000);
								});
							});
						}

						addCopyButtons();
					});

			}
			else {
				alert("暂不支持预览此类型文件");
				return;
			}

			document.getElementById('preview-modal').style.display = 'block';
		}

		function closePreview() {
			document.getElementById('preview-modal').style.display = 'none';
		}

		async function loadFiles(path) {
			try {
				const data = await getFileList(path);

				const fileList = document.getElementById('file-list');
				fileList.innerHTML = '';

				if (data.parent) {
					const parentRow = document.createElement('tr');
					parentRow.innerHTML = `
                        <td colspan="5">
                            <div class="file-item">
                                <i class="fas fa-level-up-alt file-icon"></i>
                                <a href="#" class="folder-link" data-path="${data.parent}">返回上一级</a>
                            </div>
                        </td>
                    `;
					fileList.appendChild(parentRow);
				}

				data.folders.forEach(folder => {
					const row = document.createElement('tr');
					row.innerHTML = `
						<td>&nbsp;-</td>
                        <td>
                            <div class="file-item folder">
                                <i class="fas fa-folder file-icon"></i>
                                <a href="#" class="folder-link file-name" data-path="${folder.path}">${folder.name}</a>
                            </div>
                        </td>
                        <td>文件夹</td>
                        <td>-</td>
                        <td>${folder.modified}</td>
                        <td>
                            <div class="file-actions">
                                <button class="btn btn-primary btn-sm" onclick="downloadFolder('${folder.path}')">
                                    <i class="fas fa-file-archive"></i> 打包下载
                                </button>
                            </div>
                        </td>
                    `;
					fileList.appendChild(row);
				});

				data.files.forEach(file => {
					const row = document.createElement('tr');
					row.innerHTML = `
    <td><input type="checkbox" class="file-checkbox" data-path="${file.path}"></td>
    <td>
        <div class="file-item file">
            <i class="fas ${getFileIcon(file.type)} file-icon"></i>
            <span class="file-name"><a href="#" style="color: #333;" onclick="previewFile('${file.path}', '${file.type}')">${file.name}</a></span>
        </div>
    </td>
    <td>${file.type}</td>
    <td>${formatFileSize(file.size)}</td>
    <td>${file.modified}</td>
    <td>
        <div class="file-actions">
            <button class="btn btn-primary btn-sm" onclick="downloadFile('${file.path}')">
                <i class="fas fa-download"></i> 下载
            </button>
        </div>
    </td>
`;
					fileList.appendChild(row);
				});

				if (data.folders.length === 0 && data.files.length === 0) {
					const row = document.createElement('tr');
					row.innerHTML = `
                        <td colspan="5">
                            <div class="empty-folder">
                                <i class="far fa-folder-open"></i>
                                <p>此文件夹为空</p>
                            </div>
                        </td>
                    `;
					fileList.appendChild(row);
				}
			} catch (error) {
				console.error('Error:', error);
				alert('加载文件列表失败: ' + error.message);
			}
		}

		async function getFileList(path) {
			return simulateFileList(path);
		}

		function simulateFileList(path) {
			return new Promise((resolve) => {
				const mockData = {
					parent: path ? path.split('/').slice(0, -1).join('/') : null,
					folders: [],
					files: []
				};

				if (path === '') {
					mockData.folders = [
						{ name: '一中', path: '一中', modified: '2025-07-14' },
						{ name: 'CSP-J1备考班(2024暑)', path: 'CSP-J1备考班(2024暑)', modified: '2025-07-14' },
						{ name: 'CSP-J2集训(10.10-10.18)', path: 'CSP-J2集训(10.10-10.18)', modified: '2025-07-14' },
						{ name: 'J1衔接班', path: 'J1衔接班', modified: '2025-07-14' },
						{ name: 'Z2-1(S班)', path: 'Z2-1(S班)', modified: '2025-07-14' },
						{ name: 'Z2-2(S班)', path: 'Z2-2(S班)', modified: '2025-07-14' },
						{ name: '插件', path: '插件', modified: '2025-07-14' },
						{ name: 'VJudge Helper', path: 'VJudge Helper', modified: '2025-07-14' },
					];
					mockData.files = [
						{ name: 'GESP编程等级认证大纲1-8级 C++ & Python.pdf', path: 'GESP编程等级认证大纲1-8级 C++ & Python.pdf', type: 'PDF 可携带文件', size: 1291 * 1024, modified: '2025-07-14' },
						{ name: 'NOI 大纲(2023年修订版).pdf', path: 'NOI 大纲(2023年修订版).pdf', type: 'PDF 可携带文件', size: 6450 * 1024, modified: '2025-07-14' }
					];
				} else if (path === '一中') {
					mockData.files = [
						{ name: '树基础.pptx', path: '一中/树基础.pptx', type: 'PPTX 演示文稿', size: 519 * 1024, modified: '2025-07-14' },
						{ name: '线性数据结构.pptx', path: '一中/线性数据结构.pptx', type: 'PPTX 演示文稿', size: 4164 * 1024, modified: '2025-07-14' },
						{ name: '习题1.pdf', path: '一中/习题1.pdf', type: 'PDF 可携带文件', size: 303 * 1024, modified: '2025-07-14' },
						{ name: '习题1 - 题解.pdf', path: '一中/习题1 - 题解.pdf', type: 'PDF 可携带文件', size: 315 * 1024, modified: '2025-07-14' },
						{ name: 'slide.pdf', path: '一中/slide.pdf', type: 'PDF 可携带文件', size: 13781 * 1024, modified: '2025-07-14' },
						{ name: 'slide-1.pdf', path: '一中/slide-1.pdf', type: 'PDF 可携带文件', size: 15778 * 1024, modified: '2025-07-14' },
						{ name: 'slide-2.pdf', path: '一中/slide-2.pdf', type: 'PDF 可携带文件', size: 7274 * 1024, modified: '2025-07-14' },
						{ name: '题目.pdf', path: '一中/题目.pdf', type: 'PDF 可携带文件', size: 106 * 1024, modified: '2025-07-14' },
						{ name: '小测.pdf', path: '一中/小测.pdf', type: 'PDF 可携带文件', size: 80 * 1024, modified: '2025-07-14' },
						{ name: '小测 (1).pdf', path: '一中/小测 (1).pdf', type: 'PDF 可携带文件', size: 80 * 1024, modified: '2025-07-14' },
						{ name: '小测 (2).pdf', path: '一中/小测 (2).pdf', type: 'PDF 可携带文件', size: 162 * 1024, modified: '2025-07-14' },
						{ name: '动态规划经典问题.pptx', path: '一中/动态规划经典问题.pptx', type: 'PPTX 演示文稿', size: 924 * 1024, modified: '2025-07-14' },
						{ name: '数字三角形问题.pptx', path: '一中/数字三角形问题.pptx', type: 'PPTX 演示文稿', size: 1008 * 1024, modified: '2025-07-14' },
						{ name: '重叠子问题——递推和动规导入.pptx', path: '一中/重叠子问题——递推和动规导入.pptx', type: 'PPTX 演示文稿', size: 1200 * 1024, modified: '2025-07-14' },
					];
				} else if (path === '插件') {
					mockData.files = [
						{ name: 'stylus.crx', path: '插件/stylus.crx', type: 'CRX 文件', size: 1032 * 1024, modified: '2025-07-14' },
						{ name: '篡改猴.crx', path: '插件/篡改猴.crx', type: 'CRX 文件', size: 1627 * 1024, modified: '2025-07-14' }
					];
				} else if (path === 'VJudge Helper') {
					mockData.files = [
						{ name: 'vjudge_helper_v1.2.zip', path: 'VJudge Helper/vjudge_helper_v1.2.zip', type: 'ZIP 压缩文件', size: 30 * 1024, modified: '2025-07-14' }
					];
				} else if (path === 'CSP-J1备考班(2024暑)') {
					mockData.files = [
						{ name: 'CSP-J1备考班(2024暑) 1-5讲.zip', path: 'CSP-J1备考班(2024暑)/CSP-J1备考班(2024暑) 1-5讲.zip', type: 'ZIP 压缩文件', size: 24384 * 1024, modified: '2025-07-14' },
						{ name: 'CSP-J1备考班(2024暑) 6-10讲.zip', path: 'CSP-J1备考班(2024暑)/CSP-J1备考班(2024暑) 6-10讲.zip', type: 'ZIP 压缩文件', size: 23949 * 1024, modified: '2025-07-14' }
					];
				} else if (path === 'CSP-J2集训(10.10-10.18)') {
					mockData.files = [
						{ name: 'CSP-J2集训(10.10-10.18).zip', path: 'CSP-J2集训(10.10-10.18)/CSP-J2集训(10.10-10.18).zip', type: 'ZIP 压缩文件', size: 1748 * 1024, modified: '2025-07-14' }
					];
				} else if (path === 'J1衔接班') {
					mockData.files = [
						{ name: 'J1衔接班.zip', path: 'J1衔接班/J1衔接班.zip', type: 'ZIP 压缩文件', size: 2390 * 1024, modified: '2025-07-14' }
					];
				} else if (path === 'Z2-1(S班)') {
				    mockData.files = [
						{ name: 'Z2-1(S班).zip', path: 'Z2-1(S班)/Z2-1(S班).zip', type: 'ZIP 压缩文件', size: 5170 * 1024, modified: '2025-07-14' }
					];
				} else if (path === 'Z2-2(S班)') {
					mockData.files = [
						{ name: 'Z2-2(S班).zip', path: 'Z2-2(S班)/Z2-2(S班).zip', type: 'ZIP 压缩文件', size: 5032 * 1024, modified: '2025-07-14' }
					];
				}

				resolve(mockData);
			});
		}

		function getCurrentDate() {
			const now = new Date();
			return now.toISOString().split('T')[0];
		}

		function updateBreadcrumb(path) {
			const breadcrumb = document.getElementById('breadcrumb');
			breadcrumb.innerHTML = `
                <a href="#" data-path="">
                    <i class="fas fa-home"></i> 首页
                </a>
            `;

			if (!path) return;

			const parts = path.split('/').filter(p => p);
			let currentPath = '';

			parts.forEach((part, index) => {
				currentPath += (currentPath ? '/' : '') + part;
				const separator = document.createElement('span');
				separator.className = 'separator';
				separator.innerHTML = '<i class="fas fa-chevron-right"></i>';
				breadcrumb.appendChild(separator);

				const link = document.createElement('a');
				link.href = '#';
				link.setAttribute('data-path', currentPath);
				link.innerHTML = `<i class="fas ${index === parts.length - 1 ? 'fa-folder-open' : 'fa-folder'}"></i> ${part}`;
				breadcrumb.appendChild(link);
			});
		}

		function getFileIcon(type) {
			if (type.includes('PDF')) return 'fa-file-pdf';
			if (type.includes('Word')) return 'fa-file-word';
			if (type.includes('Excel')) return 'fa-file-excel';
			if (type.includes('PowerPoint')) return 'fa-file-powerpoint';
			if (type.includes('图片')) return 'fa-file-image';
			if (type.includes('视频')) return 'fa-file-video';
			if (type.includes('音频')) return 'fa-file-audio';
			if (type.includes('压缩')) return 'fa-file-archive';
			if (type.includes('代码')) return 'fa-file-code';
			return 'fa-file';
		}

		function formatFileSize(bytes) {
			if (bytes === 0) return '0 Bytes';
			const k = 1024;
			const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
			const i = Math.floor(Math.log(bytes) / Math.log(k));
			return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
		}

		async function getAllFilesInFolder(path) {
			const data = await simulateFileList(path);
			let allFiles = [...data.files];

			for (const folder of data.folders) {
				const subFiles = await getAllFilesInFolder(folder.path);
				allFiles = allFiles.concat(subFiles);
			}

			return allFiles;
		}

		function downloadFile(path) {
			const link = document.createElement('a');
			link.href = `sources/${encodeURIComponent(path)}`;
			link.download = path.split('/').pop();
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
		}

		async function downloadFolder(path) {
			try {
				const zip = new JSZip();
				const folderName = path || 'folder';
				const currentFolder = zip.folder(folderName);

				const fileList = await getAllFilesInFolder(path);

				if (fileList.length === 0) {
					alert("该文件夹为空");
					return;
				}

				const promises = [];

				fileList.forEach(file => {
					const filePath = file.path;
					const fileName = filePath.replace(path + '/', '');

					const url = `sources/${filePath}`;

					promises.push(
						fetch(url)
							.then(res => {
								if (!res.ok) throw new Error(`文件 ${url} 不存在`);
								return res.arrayBuffer();
							})
							.then(data => {
								currentFolder.file(fileName, data);
							})
					);
				});

				await Promise.all(promises);

				const content = await zip.generateAsync({ type: "blob" });
				saveAs(content, `${folderName}.zip`);
			} catch (err) {
				console.error('打包失败:', err);
				alert("打包失败，文件 " + err.message + " 不存在。");
			}
		}
	</script>
</body>

</html>
